<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Uniform Stock Manager | Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --blue1:#89f7fe; --blue2:#66a6ff; --text:#333;
  }
  body{
    font-family:'Roboto',sans-serif;
    margin:0; padding:0;
    background:linear-gradient(120deg,var(--blue1),var(--blue2));
    background-size:400% 400%;
    animation:gradientBG 15s ease infinite;
    color:var(--text);
  }
  @keyframes gradientBG{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 20px; background:rgba(255,255,255,0.8); backdrop-filter:blur(6px);
    flex-wrap:wrap; text-align:center;
  }
  header img{height:60px;animation:breathe 3s ease-in-out infinite alternate;}
  @keyframes breathe{0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);}}
  header h1{font-size:24px;margin:10px auto;flex:1;text-align:center;}
  button{
    padding:8px 14px;margin:4px;cursor:pointer;border:none;border-radius:6px;
    background:var(--blue2);color:#fff;font-weight:600;transition:.3s;
  }
  button:hover{background:var(--blue1);color:#000;}
  section{
    background:rgba(255,255,255,0.95);margin:20px;padding:20px;border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
  }
  h2{text-align:center;margin-top:0;}
  table{width:100%;border-collapse:collapse;margin-top:15px;}
  th,td{border:1px solid #aaa;padding:8px;text-align:center;}
  input,select{width:100%;padding:6px;margin-top:5px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px;}
  input[readonly]{background:#eee;}
  form div{margin-bottom:10px;}
  .hidden{display:none;}
  .rtl{direction:rtl;text-align:right;font-family:'Tajawal',sans-serif;}
  @media(max-width:600px){
    header h1{font-size:20px;}
    section{margin:10px;padding:15px;}
  }
</style>
</head>
<body>

<header>
  <img src="https://i.ibb.co/N0Bdr5N/Care-Pro-Logo-Jan-2025-Transparent.png" alt="Logo">
  <h1 id="title">Uniform Stock Manager</h1>
  <button onclick="toggleLang()" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
</header>

<section id="stockSection">
  <h2 id="stockTitle">Stock</h2>
  <button onclick="exportStock()" id="exportStockBtn">Export Full Stock</button>
  <table id="stockTable">
    <thead>
      <tr>
        <th id="itemHead">Item</th>
        <th id="sizeHead">Size</th>
        <th id="qtyHead">Available Qty</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="loginSection">
  <h2 id="loginTitle">Login</h2>
  <div id="loginDiv">
    <div><input type="text" id="userId" placeholder="User ID"></div>
    <div><input type="password" id="password" placeholder="Password"></div>
    <button onclick="login()" id="loginBtn">Login</button>
  </div>
</section>

<section id="mainApp" class="hidden">
  <h2 id="entryTitle">Delivery / Return Entry</h2>
  <button onclick="exportReport()" id="exportReportBtn">Export Delivery Report</button>
  <form id="entryForm">
    <div><input type="text" id="iqama" placeholder="Iqama" required></div>
    <div><input type="text" id="emp" placeholder="Employee Name" required></div>
    <div><input type="date" id="date" required></div>
    <div><select id="item"></select><select id="size"></select></div>
    <div><input type="number" id="qty" placeholder="Quantity" required min="1"></div>
    <div><input type="text" id="client" placeholder="Client"></div>
    <div><input type="text" id="note" placeholder="Note"></div>
    <button type="submit" id="addEntryBtn">Add Entry</button>
  </form>

  <h2 id="transTitle">Transactions</h2>
  <table id="transTable">
    <thead>
      <tr>
        <th>ID</th><th id="iqamaHead">Iqama</th><th id="nameHead">Name</th><th id="dateHead">Date</th>
        <th id="itemHead2">Item</th><th id="sizeHead2">Size</th><th id="qtyHead2">Qty</th>
        <th id="clientHead">Client</th><th id="noteHead">Note</th><th id="actionHead">Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
let lang='en';
const BASE='https://your-vercel-deployment.vercel.app/api'; // replace
const USERS=[{id:'admin',password:'1234'}];
let stockData=[],transactions=[];

const t={
  en:{
    title:'Uniform Stock Manager',
    stock:'Stock',login:'Login',entry:'Delivery / Return Entry',trans:'Transactions',
    exportStock:'Export Full Stock',exportReport:'Export Delivery Report',
    user:'User ID',pass:'Password',loginBtn:'Login',addEntry:'Add Entry',
    notEnough:'Not enough stock',invalid:'Invalid credentials',langBtn:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'
  },
  ar:{
    title:'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
    stock:'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',login:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',entry:'ØªØ³Ù„ÙŠÙ… / Ø¥Ø±Ø¬Ø§Ø¹',trans:'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª',
    exportStock:'ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙƒØ§Ù…Ù„',exportReport:'ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ù„ÙŠÙ…',
    user:'Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',pass:'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',loginBtn:'Ø¯Ø®ÙˆÙ„',addEntry:'Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø®Ø§Ù„',
    notEnough:'Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©',invalid:'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©',langBtn:'English'
  }
};

function setText(id,key){document.getElementById(id).innerText=t[lang][key];}
function setPlaceholder(id,key){document.getElementById(id).placeholder=t[lang][key];}

function toggleLang(){
  lang=lang==='en'?'ar':'en';
  document.body.className=lang==='ar'?'rtl':'';
  setText('title','title');
  setText('stockTitle','stock');
  setText('loginTitle','login');
  setText('entryTitle','entry');
  setText('transTitle','trans');
  setText('exportStockBtn','exportStock');
  setText('exportReportBtn','exportReport');
  setText('loginBtn','loginBtn');
  setText('addEntryBtn','addEntry');
  document.getElementById('langBtn').innerText=t[lang]['langBtn'];
  setPlaceholder('userId','user');
  setPlaceholder('password','pass');
}

async function login(){
  const id=document.getElementById('userId').value.trim();
  const password=document.getElementById('password').value.trim();
  const res=await fetch(BASE+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,password})});
  const data=await res.json();
  if(data.success){
    document.getElementById('loginSection').style.display='none';
    document.getElementById('mainApp').classList.remove('hidden');
    await loadStock(); await loadTransactions(); setupEntryForm();
  }else alert(t[lang].invalid);
}

async function loadStock(){
  const res=await fetch(BASE+'/stock'); stockData=await res.json(); renderStock();
}
function renderStock(){
  const tbody=document.querySelector('#stockTable tbody');
  tbody.innerHTML='';
  const itemSel=document.getElementById('item'); const sizeSel=document.getElementById('size');
  itemSel.innerHTML=''; sizeSel.innerHTML='';
  stockData.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.Item}</td><td>${r.Size}</td><td><input type="number" value="${r.Quantity}" readonly></td>`;
    tbody.appendChild(tr);
    if(![...itemSel.options].some(o=>o.value===r.Item)) itemSel.innerHTML+=`<option>${r.Item}</option>`;
  });
}

async function loadTransactions(){
  const res=await fetch(BASE+'/transactions'); transactions=await res.json(); renderTransactions();
}
function renderTransactions(){
  const tbody=document.querySelector('#transTable tbody'); tbody.innerHTML='';
  transactions.forEach(tn=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${tn.id}</td><td>${tn.iqama}</td><td>${tn.emp}</td><td>${tn.date}</td><td>${tn.item}</td><td>${tn.size}</td><td>${tn.qty}</td><td>${tn.client}</td><td>${tn.note}</td>
    <td><button onclick="deleteTrans('${tn.id}')">ðŸ—‘</button></td>`;
    tbody.appendChild(tr);
  });
}

function setupEntryForm(){
  const form=document.getElementById('entryForm');
  const sizeSel=document.getElementById('size'); const itemSel=document.getElementById('item');
  itemSel.addEventListener('change',updateSizes); updateSizes();
  form.onsubmit=async(e)=>{
    e.preventDefault();
    const entry={
      id:Date.now().toString(),
      iqama:iqama.value,emp:emp.value,date:date.value,
      item:itemSel.value,size:sizeSel.value,
      qty:parseInt(qty.value),client:client.value,note:note.value
    };
    const row=stockData.find(r=>r.Item===entry.item&&r.Size===entry.size);
    if(!row||row.Quantity<entry.qty){alert(t[lang].notEnough);return;}
    row.Quantity-=entry.qty;
    await fetch(BASE+'/stock',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(stockData)});
    await fetch(BASE+'/transactions',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(entry)});
    await loadStock(); await loadTransactions(); form.reset();
  };
}

function updateSizes(){
  const item=itemSel.value;
  const sizes=stockData.filter(r=>r.Item===item).map(r=>r.Size);
  sizeSel.innerHTML=''; sizes.forEach(s=>sizeSel.innerHTML+=`<option>${s}</option>`);
}

async function deleteTrans(id){
  await fetch(BASE+'/transactions/'+id,{method:'DELETE'});
  await loadStock(); await loadTransactions();
}

function exportStock(){
  let csv='Item,Size,Quantity\n';
  stockData.forEach(r=>csv+=`${r.Item},${r.Size},${r.Quantity}\n`);
  downloadCSV(csv,'full_stock.csv');
}
function exportReport(){
  let csv='Iqama,Name,Date,Item,Size,Qty,Client,Note\n';
  transactions.forEach(tn=>csv+=`${tn.iqama},${tn.emp},${tn.date},${tn.item},${tn.size},${tn.qty},${tn.client},${tn.note}\n`);
  downloadCSV(csv,'delivery_report.csv');
}
function downloadCSV(csv,name){
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');
  a.href=url;a.download=name;a.click();URL.revokeObjectURL(url);
}

loadStock();
</script>
</body>
</html>
