<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uniform Stock Manager | Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --blue1:#89f7fe; --blue2:#66a6ff; --text:#333;
}
body{
  font-family:'Roboto',sans-serif;
  margin:0; padding:0;
  background:linear-gradient(120deg,var(--blue1),var(--blue2));
  background-size:400% 400%;
  animation:gradientBG 15s ease infinite;
  color:var(--text);
}
@keyframes gradientBG{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
header{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 20px; background:rgba(255,255,255,0.8); backdrop-filter:blur(6px);
  flex-wrap:wrap; text-align:center;
}
header img{height:60px;animation:breathe 3s ease-in-out infinite alternate;}
@keyframes breathe{0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);}}
header h1{font-size:24px;margin:10px auto;flex:1;text-align:center;}
button{
  padding:8px 14px;margin:4px;cursor:pointer;border:none;border-radius:6px;
  background:var(--blue2);color:#fff;font-weight:600;transition:.3s;
}
button:hover{background:var(--blue1);color:#000;}
section{
  background:rgba(255,255,255,0.95);margin:20px;padding:20px;border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
h2{text-align:center;margin-top:0;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #aaa;padding:8px;text-align:center;}
input,select{width:100%;padding:6px;margin-top:5px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px;}
input[readonly]{background:#eee;}
form div{margin-bottom:10px;}
.hidden{display:none;}
.rtl{direction:rtl;text-align:right;font-family:'Tajawal',sans-serif;}
@media(max-width:600px){
  header h1{font-size:20px;}
  section{margin:10px;padding:15px;}
}
</style>
</head>
<body>

<header>
  <img src="https://i.ibb.co/N0Bdr5N/Care-Pro-Logo-Jan-2025-Transparent.png" alt="Logo">
  <h1 id="title">Uniform Stock Manager</h1>
  <button onclick="toggleLang()" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
</header>

<!-- Stock before login -->
<section id="stockSection">
  <h2 id="stockTitle">Stock</h2>
  <table id="stockTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Manual Qty</th>
        <th>Delivered Qty</th>
        <th>Available Qty</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Download report always visible -->
<button onclick="exportReport()" id="exportReportBtn">Export Delivery Report</button>

<!-- Login section -->
<section id="loginSection">
  <h2 id="loginTitle">Login</h2>
  <div id="loginDiv">
    <div><input type="text" id="userId" placeholder="User ID"></div>
    <div><input type="password" id="password" placeholder="Password"></div>
    <button onclick="login()" id="loginBtn">Login</button>
  </div>
</section>

<!-- Admin only section -->
<section id="adminSection" class="hidden">
  <h2>Add / Edit Stock</h2>
  <form id="stockForm">
    <div><input type="text" id="newItem" placeholder="Item Name" required></div>
    <div><input type="number" id="newQty" placeholder="Manual Qty" min="1" required></div>
    <button type="submit">Add / Update Stock</button>
  </form>

  <h2>Delivery / Return Entry</h2>
  <form id="entryForm">
    <div><input type="text" id="iqama" placeholder="Iqama" required></div>
    <div><input type="text" id="emp" placeholder="Employee Name" required></div>
    <div><input type="date" id="date" required></div>
    <div><select id="item"></select></div>
    <div><input type="number" id="qty" placeholder="Quantity" required min="1"></div>
    <div><input type="text" id="client" placeholder="Client"></div>
    <div><input type="text" id="note" placeholder="Note"></div>
    <button type="submit">Add Entry</button>
  </form>

  <h2>Transactions</h2>
  <table id="transTable">
    <thead>
      <tr>
        <th>ID</th><th>Iqama</th><th>Name</th><th>Date</th>
        <th>Item</th><th>Qty</th><th>Client</th><th>Note</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
let lang='en';
const BASE='https://your-vercel-deployment.vercel.app/api'; // replace
const USERS=[{id:'admin',password:'1234'}];
let stockData=[],transactions=[];

const t={
  en:{title:'Uniform Stock Manager',stock:'Stock',login:'Login',admin:'Admin Panel',exportReport:'Export Delivery Report',invalid:'Invalid credentials',langBtn:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',addEntry:'Add Entry',addStock:'Add / Update Stock',iqama:'Iqama',emp:'Employee Name',date:'Date',item:'Item',qty:'Quantity',client:'Client',note:'Note'},
  ar:{title:'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',stock:'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',login:'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',admin:'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',exportReport:'ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ù„ÙŠÙ…',invalid:'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©',langBtn:'English',addEntry:'Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø®Ø§Ù„',addStock:'Ø¥Ø¶Ø§ÙØ© / ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',iqama:'Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©',emp:'Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù',date:'Ø§Ù„ØªØ§Ø±ÙŠØ®',item:'Ø§Ù„ØµÙ†Ù',qty:'Ø§Ù„ÙƒÙ…ÙŠØ©',client:'Ø§Ù„Ø¹Ù…ÙŠÙ„',note:'Ù…Ù„Ø§Ø­Ø¸Ø©'}
};

function toggleLang(){
  lang=lang==='en'?'ar':'en';
  document.body.className=lang==='ar'?'rtl':'';
  document.getElementById('title').innerText=t[lang].title;
  document.getElementById('stockTitle').innerText=t[lang].stock;
  document.getElementById('loginTitle').innerText=t[lang].login;
  document.getElementById('exportReportBtn').innerText=t[lang].exportReport;
  document.getElementById('loginBtn').innerText=t[lang].login;
}

function renderStock(){
  const tbody=document.querySelector('#stockTable tbody'); tbody.innerHTML='';
  stockData.forEach(r=>{
    const delivered = transactions.filter(tr=>tr.item===r.Item).reduce((a,b)=>a+b.qty,0);
    const available = r.ManualQty - delivered;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.Item}</td><td>${r.ManualQty}</td><td>${delivered}</td><td>${available}</td>`;
    tbody.appendChild(tr);
  });
}

async function loadStock(){
  const res=await fetch(BASE+'/stock'); stockData=await res.json(); renderStock(); populateItemSelect();
}

async function loadTransactions(){
  const res=await fetch(BASE+'/transactions'); transactions=await res.json(); renderTransactions(); renderStock();
}

function renderTransactions(){
  const tbody=document.querySelector('#transTable tbody'); tbody.innerHTML='';
  transactions.forEach(tn=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${tn.id}</td><td>${tn.iqama}</td><td>${tn.emp}</td><td>${tn.date}</td><td>${tn.item}</td><td>${tn.qty}</td><td>${tn.client}</td><td>${tn.note}</td>
    <td><button onclick="deleteTrans('${tn.id}')">ðŸ—‘</button></td>`;
    tbody.appendChild(tr);
  });
}

function populateItemSelect(){
  const sel=document.getElementById('item'); sel.innerHTML='';
  stockData.forEach(s=>sel.innerHTML+=`<option>${s.Item}</option>`);
}

// Login unlock
function login(){
  const id=document.getElementById('userId').value.trim();
  const password=document.getElementById('password').value.trim();
  if(USERS.some(u=>u.id===id && u.password===password)){
    document.getElementById('loginSection').style.display='none';
    document.getElementById('adminSection').classList.remove('hidden');
    loadStock(); loadTransactions();
  } else alert(t[lang].invalid);
}

// Add / Update Stock manually
document.getElementById('stockForm').onsubmit=async function(e){
  e.preventDefault();
  const name=document.getElementById('newItem').value.trim();
  const qty=parseInt(document.getElementById('newQty').value);
  const existing=stockData.find(s=>s.Item===name);
  if(existing) existing.ManualQty+=qty;
  else stockData.push({Item:name,ManualQty:qty});
  await fetch(BASE+'/stock',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(stockData)});
  renderStock(); populateItemSelect(); e.target.reset();
};

// Delivery / Return Entry
document.getElementById('entryForm').onsubmit=async function(e){
  e.preventDefault();
  const entry={
    id:Date.now().toString(),
    iqama:iqama.value,
    emp:emp.value,
    date:date.value,
    item:item.value,
    qty:parseInt(qty.value),
    client:client.value,
    note:note.value
  };
  const stockRow=stockData.find(s=>s.Item===entry.item);
  const delivered=transactions.filter(tr=>tr.item===entry.item).reduce((a,b)=>a+b.qty,0);
  const available=stockRow.ManualQty - delivered;
  if(entry.qty>available){alert('Not enough stock'); return;}
  transactions.push(entry);
  await fetch(BASE+'/transactions',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(entry)});
  renderTransactions(); renderStock(); e.target.reset();
};

// Delete transaction
async function deleteTrans(id){
  const idx=transactions.findIndex(t=>t.id===id); if(idx>-1) transactions.splice(idx,1);
  await fetch(BASE+'/transactions/'+id,{method:'DELETE'});
  renderTransactions(); renderStock();
}

// Export report
function exportReport(){
  let csv='ID,Iqama,Name,Date,Item,Qty,Client,Note\n';
  transactions.forEach(tn=>csv+=`${tn.id},${tn.iqama},${tn.emp},${tn.date},${tn.item},${tn.qty},${tn.client},${tn.note}\n`);
  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='delivery_report.csv'; a.click(); URL.revokeObjectURL(url);
}

loadStock();
</script>
</body>
</html>
